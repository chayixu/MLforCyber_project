# -*- coding: utf-8 -*-
"""eval_multi_trigger_fineprune.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1d0Bqrwt0btzVvkAvS1fZNh1oiyBOHzc3
"""

import sys
import matplotlib.image as mpimg
import h5py
import keras
import numpy as np
from call_filter import filter


input = sys.argv[1]


def data_loader(filepath):
    data = h5py.File(filepath, 'r')
    x_data = np.array(data['data'])
    y_data = np.array(data['label'])
    x_data = x_data.transpose((0,2,3,1))
    return x_data, y_data

def data_preprocess(x_data):
    return x_data/255

def main():
  if '.h5' in input:
    x,y = data_loader(input)
    x = data_preprocess(x)
  else:
    x = mpimg.imread(input)
  label_filtered = filter(x, "models/multi_trigger_multi_target_bd_net.h5", "repaired_model/multi_trigger_repaired.h5")
  if len(label_filtered) == 1:
    print('output label(s)')
    print(label_filtered[0])
  else:
    print('output label(s)')
    print(label_filtered)

if __name__ == '__main__':
    main()

